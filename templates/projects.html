{% extends "base.html" %}

{% block title %}My Projects - NoteTrail{% endblock %}

{% block content %}
<header class="header">
    <div class="flex justify-between items-center">
        <div>
            <h1>My Projects</h1>
            <p>Manage your writing projects and track your progress</p>
        </div>
        <a href="{{ url_for('create_project') }}" class="btn btn-primary">New Project</a>
    </div>
</header>

<div class="content">
    <!-- Project Stats -->
    <div class="stats-grid mb-8">
        <div class="stat-card">
            <div class="stat-label">Total Projects</div>
            <div class="stat-value">{{ project_stats.total }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Active Projects</div>
            <div class="stat-value">{{ project_stats.active }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Drafts</div>
            <div class="stat-value">{{ project_stats.drafts }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Completed</div>
            <div class="stat-value">{{ project_stats.completed }}</div>
        </div>
    </div>
    
    <!-- Projects List -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">All Projects</h2>
        </div>
        <div class="card-content">
            {% if projects %}
                <div class="grid gap-6">
                    {% for project in projects %}
                    <div class="card">
                        <div class="card-content">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-xl mb-2">{{ project.title }}</h3>
                                    <p class="text-muted-foreground mb-3">{{ project.description or "No description provided" }}</p>
                                    
                                    <div class="flex flex-wrap gap-2 mb-3">
                                        <span class="text-sm px-2 py-1 bg-secondary rounded">{{ project.status.replace('_', ' ').title() }}</span>
                                        <span class="text-sm text-muted-foreground">{{ project.chapters_count or 0 }} chapters</span>
                                        <span class="text-sm text-muted-foreground">Updated {{ project.updated_at.strftime('%b %d, %Y') }}</span>
                                    </div>
                                    
                                    <!-- Progress -->
                                    <div class="mb-3">
                                        <div class="flex justify-between text-sm mb-1">
                                            <span>Progress</span>
                                            <span>{{ project.word_count }} / {{ project.word_goal }} words ({{ (project.word_count / project.word_goal * 100)|round|int if project.word_goal > 0 else 0 }}%)</span>
                                        </div>
                                        <div class="w-full bg-secondary rounded-full h-2">
                                            <div class="bg-primary h-2 rounded-full" style="width: {{ (project.word_count / project.word_goal * 100) if project.word_goal > 0 else 0 }}%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex flex-col gap-2 ml-4">
                                    <a href="{{ url_for('project_detail', id=project.id) }}" class="btn btn-outline btn-sm">View Details</a>
                                    <a href="{{ url_for('workspace', project_id=project.id) }}" class="btn btn-primary btn-sm">Continue Writing</a>
                                    <button onclick="deleteProject({{ project.id }})" class="btn btn-outline btn-sm text-destructive">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üìù</div>
                    <h3 class="empty-title">No projects yet</h3>
                    <p class="empty-text">Create your first writing project to get started on your writing journey.</p>
                    <a href="{{ url_for('create_project') }}" class="btn btn-primary">Create Your First Project</a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function deleteProject(projectId) {
    if (confirm('Are you sure you want to delete this project? This action cannot be undone.')) {
        fetch(`/api/projects/${projectId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('Error deleting project');
            }
        })
        .catch(error => {
            alert('Error deleting project');
        });
    }
}
</script>
{% endblock %}